{% extends "base.html" %}

{% block app_content %}
    <h2>Users {{ user.username }} offers {{ total_instances }} books</h2>
    <table>
        <tr valign="top">
            <td>
            {% if user.avatar %}
                <img src="{{ user.avatar }}">
            {% else %}
                <img src="/static/avatar/default_avatar.png" >
            {% endif %}
            </td>
            <td>
                {% if user.about_me %}<p>{{ user.about_me }}</p>{% endif %}
                {% if user.last_seen %}<p>Last seen on: {{ moment(user.last_seen).format('LLL') }}</p>{% endif %}

                {% if user == current_user %}
                    <p><a href="{{ url_for('edit_profile') }}">Edit profile</a></p>
                {% endif %}
            </td>
        </tr>
    </table>

    <h2> Active books </h2>
    <table class="table table-hover">
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Author</th>
            <th>Price</th>
            {% if user == current_user %}
                <th>Actions</th>
            {% endif %}
        </tr>
        {% for book_instance in book_instances %}
            {% if book_instance.is_active %}
                <tr>
                    <td>{{ book_instance.id }}</td>
                    <td>{{ book_instance.title }}</td>
                    <td>{{ book_instance.author }}</td>
                    <td>{{ book_instance.price }}</td>
                    {% if user == current_user %}
                    <td>
                        <button type="button" onclick='window.location.href="{{ url_for('deactivate_book_instance', book_instance_id=book_instance.id) }}"'>deactivate</button>
                        <button type="button" onclick='window.location.href="{{ url_for('edit_book_instance', book_instance_id=book_instance.id) }}"'>edit</button>
                        <button type="button" onclick='window.location.href="{{ url_for('delete_book_instance', book_instance_id=book_instance.id) }}"'>delete</button>

                    </td>
                    {% endif %}
                </tr>
            {% endif %}
        {% endfor %}
    </table>
    {% if user == current_user %}
    <h2> Inactive books </h2>
    <table class="table table-hover">
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Author</th>
            <th>Price</th>
            <th>Actions</th>
        </tr>
        {% for book_instance in book_instances %}
            {% if not book_instance.is_active %}
                <tr>
                    <td>{{ book_instance.id }}</td>
                    <td>{{ book_instance.title }}</td>
                    <td>{{ book_instance.author }}</td>
                    <td>{{ book_instance.price }}</td>
                    <td>
                        <button type="button" onclick='window.location.href="{{ url_for('activate_book_instance', book_instance_id=book_instance.id) }}"'>activate</button>
                        <button type="button" onclick='window.location.href="{{ url_for('edit_book_instance', book_instance_id=book_instance.id) }}"'>edit</button>
                        <button type="button" onclick='window.location.href="{{ url_for('delete_book_instance', book_instance_id=book_instance.id) }}"'>delete</button>
                    </td>
                </tr>
            {% endif %}
        {% endfor %}
    </table>
    {% endif %}
{% endblock %}
